<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Out of Stock Products - Smart Inventory Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .graph-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-top: 2rem;
        }
        .graph-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            width: calc(50% - 1rem);
        }
        .report-container {
            margin-top: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">
                    <span class="logo-text">Smart Inventory</span>
                </div>
                <div class="nav-links">
                    <div class="nav-item">
                        <a href="dashboard.html">Home</a>
                    </div>
                    <div class="nav-item">
                        <a href="products.html">Products</a>
                    </div>
                    <div class="nav-item">
                        <a href="sales.html">Sales</a>
                    </div>
                    <div class="nav-item">
                        <a href="inventory.html">Inventory</a>
                    </div>
                    <div class="nav-item">
                        <a href="invoices.html">Invoices</a>
                    </div>
                    <div class="nav-item">
                        <a href="index.html" class="signout-btn">Sign Out</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="container">
            <h1 class="dashboard-title">Out of Stock Products</h1>

                    <!-- Added search and sort functionality -->
            <div class="search-sort-container">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="productSearch" placeholder="Search products..." class="search-input">
                </div>
                <div class="sort-container">
                    <select id="productSort">
                        <option value="default">Default Order</option>
                        <option value="nameAsc">Name (A-Z)</option>
                        <option value="nameDesc">Name (Z-A)</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table" id="productsTable">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>MRP</th>
                            <th>Predicted Price</th>
                            <th>Stock</th>
                            <th>Quantity Prediction</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Product D</td>
                            <td>₹750</td>
                            <td>₹720</td>
                            <td>0</td>
                            <td>50</td>
                            <td>
                                <a href="vendors.html?product=Product%20D" class="action-btn">Contact Vendors</a>
                                <a href="inventory.html?product=Product%20D" class="action-btn">Analysis</a>
                            </td>
                        </tr>
                        <tr>
                            <td>Product E</td>
                            <td>₹1200</td>
                            <td>₹1150</td>
                            <td>0</td>
                            <td>30</td>
                            <td>
                                <a href="vendors.html?product=Product%20E" class="action-btn">Contact Vendors</a>
                                <a href="inventory.html?product=Product%20E" class="action-btn">Analysis</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- New Graph Section -->
        <div class="container">
            <div class="graph-container">
                <div class="graph-card">
                    <h2 class="text-xl font-semibold mb-4">Out of Stock Products Trend (Last 30 Days)</h2>
                    <canvas id="outOfStockTrendChart"></canvas>
                </div>
                <div class="graph-card">
                    <h2 class="text-xl font-semibold mb-4">Estimated Loss Due to Stock-Out</h2>
                    <canvas id="lossEstimateChart"></canvas>
                </div>
            </div>
            
            <!-- Report Section -->
            <div class="report-container">
                <h2 class="text-xl font-semibold mb-4">Stock-Out Analysis Report</h2>
                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; font-family: 'Inter', sans-serif;">
                    <p class="mb-2">Your store has experienced a concerning trend in stock-out situations this month. Key insights:</p>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem;">
                        <li>Total of 5 products are currently out of stock, a 25% increase from last month</li>
                        <li>Estimated revenue loss from stockouts: ₹45,000 this month</li>
                        <li>Product D and E have been consistently out of stock for over 7 days</li>
                        <li>Primary reason for stockouts: supplier delays (60%) and unexpected demand surges (40%)</li>
                    </ul>
                    <p class="mb-2">Recommendations:</p>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem;">
                        <li>Set up automated reorder alerts 2 days earlier for frequently out-of-stock items</li>
                        <li>Identify alternative suppliers for Product D and E to reduce dependency</li>
                        <li>Revise demand forecasting for these products based on recent sales patterns</li>
                    </ul>
                    <p style="color: #6b7280; font-style: italic; margin-top: 0.5rem;">This analysis will be dynamically generated via LLM API integration based on your actual shop data.</p>
                </div>
                
                <div style="display: flex; justify-content: flex-end; margin-top: 1.5rem;">
                    <button style="background-color: #4f46e5; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Search functionality
            const searchInput = document.getElementById('productSearch');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const tableRows = document.querySelectorAll('#productsTable tbody tr');
                
                tableRows.forEach(row => {
                    const productName = row.querySelector('td:first-child').textContent.toLowerCase();
                    if (productName.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Sorting functionality
            const sortSelect = document.getElementById('productSort');
            sortSelect.addEventListener('change', function() {
                const sortValue = this.value;
                const tableBody = document.querySelector('#productsTable tbody');
                const rows = Array.from(tableBody.querySelectorAll('tr'));
                
                if (sortValue === 'nameAsc') {
                    rows.sort((a, b) => {
                        const aName = a.querySelector('td:first-child').textContent;
                        const bName = b.querySelector('td:first-child').textContent;
                        return aName.localeCompare(bName);
                    });
                } else if (sortValue === 'nameDesc') {
                    rows.sort((a, b) => {
                        const aName = a.querySelector('td:first-child').textContent;
                        const bName = b.querySelector('td:first-child').textContent;
                        return bName.localeCompare(aName);
                    });
                } else {
                    // Default sorting (by original order)
                    rows.sort((a, b) => {
                        return Array.from(tableBody.querySelectorAll('tr')).indexOf(a) - 
                               Array.from(tableBody.querySelectorAll('tr')).indexOf(b);
                    });
                }
                
                // Clear and re-append sorted rows
                while (tableBody.firstChild) {
                    tableBody.removeChild(tableBody.firstChild);
                }
                
                rows.forEach(row => tableBody.appendChild(row));
            });

            // Out of Stock Trend Line Chart
            const outOfStockCtx = document.getElementById('outOfStockTrendChart').getContext('2d');
            const outOfStockTrendChart = new Chart(outOfStockCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 30}, (_, i) => `Day ${i+1}`),
                    datasets: [{
                        label: 'Out of Stock Products',
                        data: [2, 2, 3, 3, 3, 4, 4, 4, 3, 3, 4, 4, 5, 5, 4, 4, 3, 4, 4, 5, 5, 6, 6, 5, 5, 5, 4, 5, 5, 5],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Products: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Products'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Last 30 Days'
                            }
                        }
                    }
                }
            });
            
            // Loss Estimate Line Chart
            const lossCtx = document.getElementById('lossEstimateChart').getContext('2d');
            const lossEstimateChart = new Chart(lossCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 30}, (_, i) => `Day ${i+1}`),
                    datasets: [{
                        label: 'Daily Loss Due to Stock-Out',
                        data: [
                            1500, 1500, 2250, 2250, 2250, 3000, 3000, 3000, 2250, 2250, 
                            3000, 3000, 3750, 3750, 3000, 3000, 2250, 3000, 3000, 3750, 
                            3750, 4500, 4500, 3750, 3750, 3750, 3000, 3750, 3750, 3750
                        ],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Cumulative Loss',
                        data: [
                            1500, 3000, 5250, 7500, 9750, 12750, 15750, 18750, 21000, 23250,
                            26250, 29250, 33000, 36750, 39750, 42750, 45000, 48000, 51000, 54750,
                            58500, 63000, 67500, 71250, 75000, 78750, 81750, 85500, 89250, 93000
                        ],
                        borderColor: '#9333ea',
                        backgroundColor: 'rgba(147, 51, 234, 0.1)',
                        tension: 0.3,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ₹${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Loss Amount (₹)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Last 30 Days'
                            }
                        }
                    }
                }
            });
        });
    </script>   
</body>
</html> 